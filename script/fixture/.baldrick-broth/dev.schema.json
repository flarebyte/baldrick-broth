{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "additionalProperties": false,
  "title": "Schema for Baldrick Broth",
  "properties": {
    "engine": {
      "type": "object",
      "additionalProperties": false,
      "title": "Engine",
      "properties": {
        "defaultShell": {
          "type": "string"
        },
        "telemetry": {
          "$ref": "#/$defs/Telemetry"
        }
      },
      "required": ["defaultShell", "telemetry"]
    },
    "binaries": {
      "type": "object",
      "additionalProperties": false,
      "title": "List of binaries",
      "patternProperties": {
        "^[a-z][a-z0-9_]{1,30}$": {
          "$ref": "#/$defs/Binary"
        }
      }
    },
    "variables": {
      "type": "object",
      "additionalProperties": true,
      "title": "List of variables"
    },
    "domains": {
      "type": "object",
      "additionalProperties": false,
      "title": "List of domains",
      "patternProperties": {
        "^[a-z][a-z0-9_]{1,30}$": {
          "$ref": "#/$defs/Domain"
        }
      }
    }
  },
  "required": ["binaries", "domains", "engine", "variables"],
  "$defs": {
    "Binary": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "description": {
          "type": "string"
        },
        "motivation": {
          "type": "string"
        },
        "homepage": {
          "type": "string",
          "qt-uri-protocols": ["https"],
          "qt-uri-extensions": [".html"]
        },
        "shell": {
          "$ref": "#/$defs/Shell"
        }
      },
      "required": ["description", "homepage", "motivation", "shell"],
      "title": "Elm"
    },
    "Shell": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "run": {
          "type": "string"
        },
        "diagnosis": {
          "type": "string"
        }
      },
      "required": ["diagnosis", "run"],
      "title": "Shell"
    },
    "Domain": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "tasks": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^[a-z][a-z0-9_]{1,30}$": {
              "$ref": "#/$defs/Task"
            }
          },
          "required": ["generate"],
          "title": "Tasks"
        }
      },
      "required": ["description", "tasks", "title"],
      "title": "Test"
    },
    "Task": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "motivation": {
          "type": "string"
        },
        "visibility": {
          "type": "string"
        },
        "parameters": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^[a-z][a-z0-9_]{1,30}$": {
              "$ref": "#/$defs/Parameter"
            }
          },
          "title": "Parameters"
        },
        "steps": {
          "$ref": "#/$defs/Steps"
        },
        "finally": {
          "$ref": "#/$defs/Steps"
        }
      },
      "required": [
        "description",
        "finally",
        "motivation",
        "parameters",
        "steps",
        "title",
        "visibility"
      ],
      "title": "Generate"
    },
    "Parameter": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "description": {
          "type": "string"
        }
      },
      "required": ["description"],
      "title": "Description of the parameter"
    },
    "Steps": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/Step"
      }
    },
    "Step": {
      "oneOf": [
        {
          "$ref": "#/$defs/TaskRef"
        },
        {
          "$ref": "#/$defs/StepShell"
        }
      ]
    },
    "StepShell": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "shell": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "bin": {
              "type": "string"
            },
            "title": {
              "type": "string",
              "title": "Title for the shell step"
            },
            "if": {
              "type": "string"
            },
            "unless": {
              "type": "string"
            },
            "each": {
              "$ref": "#/$defs/Each"
            },
            "run": {
              "type": "string"
            },
            "failSilently": {
              "type": "boolean"
            }
          }
        }
      },
      "required": [],
      "title": "Step as a shell script"
    },
    "Each": {
      "type": "object",
      "patternProperties": {
        "^[a-z][a-z0-9_]{1,30}$": {
          "type": "string"
        }
      },
      "title": "Each"
    },
    "TaskRef": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "task": {
          "type": "string"
        },
        "required": ["task"],
        "title": "Reference to a task"
      }
    },
    "Telemetry": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "verbosity": {
          "type": "string"
        },
        "filepath": {
          "type": "string"
        }
      },
      "required": ["filepath", "verbosity"],
      "title": "Telemetry"
    }
  }
}
